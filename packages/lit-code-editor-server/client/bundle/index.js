(function(){'use strict';var a;(function(a){a.ESTABLISH_HANDSHAKE="ESTABLISH_HANDSHAKE",a.HANDSHAKE_RECEIVED="HANDSHAKE_RECEIVED",a.PROJECT_CONTENT="PROJECT_CONTENT",a.RESPONSES_READY="RESPONSES_READY",a.AWAITING_CONTENT="AWAITING_CONTENT"})(a||(a={}));const b=()=>new Promise(b=>{const c=d=>{const e=d.data;if(e.type===a.ESTABLISH_HANDSHAKE){const e=d.ports;if(e&&e[0]){const d=e[0];d.start();const f={type:a.HANDSHAKE_RECEIVED};d.postMessage(f),window.removeEventListener("message",c),b(d)}}};window.addEventListener("message",c)}),c=(b,c)=>new Promise(d=>{const f=new MessageChannel,e={type:a.ESTABLISH_HANDSHAKE},g=b=>{const c=b.data;c.type===a.HANDSHAKE_RECEIVED&&(f.port1.removeEventListener("message",g),d(f.port1))};if(f.port1.addEventListener("message",g),f.port1.start(),!c&&"scriptURL"in b)b.postMessage(e,[f.port2]);else if(c)b.postMessage(e,c,[f.port2]);else throw new Error("targetOrigin must be defined for message targets of type Window")}),d=async()=>{if("serviceWorker"in navigator)try{if(navigator.serviceWorker.controller){const a=await navigator.serviceWorker.getRegistrations();for(let b of a)await b.unregister()}const a=await navigator.serviceWorker.register("/editor-sw.js");window.addEventListener("unload",async()=>{await a.unregister()});const b=new Promise(b=>{a.addEventListener("updatefound",()=>{b(a.installing)})});let c=a.active;return c||(c=await b),c}catch(a){return console.error(a),null}else return null},f=()=>async b=>{if(b.data.type===a.RESPONSES_READY){const a=document.createElement("iframe");a.src="/modules/index.html",document.body.appendChild(a)}},g=b=>c=>{const d=c.data;d.type===a.PROJECT_CONTENT&&(b.addEventListener("message",f()),b.postMessage(d))},h=async()=>{if(parent===window)console.error("this is not in an iframe");else{const e=b(),f=d(),[h,i]=await Promise.all([e,f]);if(i||console.error("There was an error setting up the serviceworker"),h||console.error("there was an error setting up a message channel with your domain"),!h||!i)return;const j=await c(i,"");h.addEventListener("message",g(j));const k={type:a.AWAITING_CONTENT};h.postMessage(k)}};h()})();
